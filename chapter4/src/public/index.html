<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todo App | Modern Task Manager</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * {
      font-family: 'Inter', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .selected-tab {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      color: white !important;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .todo-item {
      transition: all 0.3s ease;
      animation: slideIn 0.4s ease-out;
    }

    .todo-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      transition: all 0.3s ease;
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(17, 153, 142, 0.4);
    }

    .btn-danger {
      background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
      transition: all 0.3s ease;
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(238, 9, 121, 0.4);
    }

    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .auth-card {
      animation: fadeIn 0.6s ease-out;
    }

    .logo-circle {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: #9ca3af;
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }

    .checkbox-custom {
      width: 24px;
      height: 24px;
      border: 2px solid #cbd5e1;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .checkbox-custom.checked {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
    }

    .progress-bar {
      height: 8px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 0.5rem;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.5s ease;
    }
  </style>
</head>

<body class="p-4 max-w-2xl mx-auto min-h-screen flex flex-col gap-6">

  <!-- AUTH SECTION -->
  <section id="auth" class="flex flex-col gap-6 items-center justify-center flex-1 fade-in">
    <div class="glass-effect rounded-2xl shadow-2xl p-8 w-full max-w-md auth-card">
      <div class="logo-circle">
        <i class="fa-solid fa-check-double text-3xl text-white"></i>
      </div>
      
      <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome Back</h2>
        <p class="text-gray-500">Sign in to manage your tasks</p>
      </div>

      <div id="error" class="hidden bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg mb-4 flex items-center gap-2">
        <i class="fa-solid fa-circle-exclamation"></i>
        <span></span>
      </div>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
          <input id="emailInput" 
            type="email"
            placeholder="your@email.com"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg transition-all" />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
          <input id="passwordInput" 
            type="password" 
            placeholder="••••••••"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg transition-all" />
        </div>

        <button id="authBtn"
          onclick="authenticate()"
          class="btn-primary text-white w-full py-3 rounded-lg font-semibold">
          Sign In
        </button>
      </div>

      <div class="mt-6 text-center">
        <p class="text-gray-600">
          <span class="register-text">Don't have an account?</span>
          <button onclick="toggleIsRegister()" id="registerBtn"
            class="text-purple-600 font-semibold hover:text-purple-700 ml-2">
            Sign up
          </button>
        </p>
      </div>
    </div>
  </section>

  <!-- DASHBOARD HEADER -->
  <header class="hidden fade-in">
    <div class="stat-card">
      <div class="flex items-center justify-between mb-3">
        <div>
          <h1 class="text-2xl font-bold"></h1>
          <p class="text-purple-100 text-sm mt-1">Stay productive and organized</p>
        </div>
        <div class="text-right">
          <div class="text-3xl font-bold" id="completionRate">0%</div>
          <div class="text-purple-100 text-xs">Complete</div>
        </div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
      </div>
    </div>
  </header>

  <!-- TABS -->
  <nav class="hidden flex gap-3 overflow-x-auto pb-2 fade-in">
    <button onclick="changeTab('All')" class="tab-button selected-tab py-3 px-6 rounded-xl font-semibold transition-all shadow-md">
      <div class="flex items-center gap-2">
        <i class="fa-solid fa-list-ul"></i>
        <span>All <span class="font-normal">(0)</span></span>
      </div>
    </button>
    <button onclick="changeTab('Open')" class="tab-button py-3 px-6 rounded-xl bg-white font-semibold transition-all shadow-md">
      <div class="flex items-center gap-2">
        <i class="fa-solid fa-clock"></i>
        <span>Active <span class="font-normal">(0)</span></span>
      </div>
    </button>
    <button onclick="changeTab('Complete')" class="tab-button py-3 px-6 rounded-xl bg-white font-semibold transition-all shadow-md">
      <div class="flex items-center gap-2">
        <i class="fa-solid fa-circle-check"></i>
        <span>Done <span class="font-normal">(0)</span></span>
      </div>
    </button>
  </nav>

  <!-- TODO LIST -->
  <main class="hidden flex-col gap-4 fade-in"></main>

  <script>
    // STATE
let token = localStorage.getItem('token');
let todos = [];
let selectedTab = "All";
let isLoading = false;
let isRegistration = false;

const apiBase = "/";

// ELEMENTS
const nav = document.querySelector("nav");
const header = document.querySelector("header");
const main = document.querySelector("main");
const navElements = document.querySelectorAll(".tab-button");
const authContent = document.getElementById("auth");
const errorBox = document.getElementById("error");
const email = document.getElementById("emailInput");
const password = document.getElementById("passwordInput");
const registerBtn = document.getElementById("registerBtn");
const authBtn = document.getElementById("authBtn");

// ---------------- UTILS ----------------

async function api(url, method = "GET", data = null) {
  const config = {
    method,
    headers: { authorization: token, "Content-Type": "application/json" }
  };

  if (data) config.body = JSON.stringify(data);
  const res = await fetch(apiBase + url, config);
  return res.json();
}

function show(el, val) {
  el.classList.toggle('hidden', !val);
}

// ---------------- UI ----------------

function showDashboard() {
  show(nav, true);
  show(header, true);
  show(main, true);
  show(authContent, false);
  fetchTodos();
}

function updateCounts() {
  const openTasks = todos.filter(t => !t.completed).length;
  const completedTasks = todos.filter(t => t.completed).length;
  const totalTasks = todos.length;
  const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

  header.querySelector("h1").innerText = `You have ${openTasks} active task${openTasks !== 1 ? 's' : ''}`;
  
  document.getElementById('completionRate').innerText = `${completionRate}%`;
  document.getElementById('progressBar').style.width = `${completionRate}%`;

  navElements.forEach(btn => {
    const tab = btn.innerText.split(" ")[0];
    const count = todos.filter(t =>
      tab === "All" ? true : tab === "Done" ? t.completed : !t.completed
    ).length;
    btn.querySelector("span span").innerText = `(${count})`;
  });
}

function renderTodos() {
  const filtered = todos.filter(t =>
    selectedTab === "All"
      ? true
      : selectedTab === "Complete"
      ? t.completed
      : !t.completed
  );

  let todoHTML = '';

  if (filtered.length === 0) {
    todoHTML = `
      <div class="empty-state glass-effect rounded-2xl shadow-lg">
        <i class="fa-solid fa-clipboard-list"></i>
        <h3 class="text-xl font-semibold mb-2">No tasks ${selectedTab === 'All' ? 'yet' : 'here'}</h3>
        <p class="text-sm">${selectedTab === 'All' ? 'Add your first task to get started!' : selectedTab === 'Complete' ? 'Complete some tasks to see them here' : 'All tasks completed! Great job!'}</p>
      </div>
    `;
  } else {
    todoHTML = filtered
      .map(
        t => `
        <div class="todo-item flex justify-between items-center glass-effect p-5 rounded-xl shadow-lg">
          <div class="flex items-center gap-4 flex-1">
            <div class="checkbox-custom ${t.completed ? 'checked' : ''}" onclick="updateTodo(${t.id})">
              ${t.completed ? '<i class="fa-solid fa-check text-white text-sm"></i>' : ''}
            </div>
            <p class="flex-1 ${t.completed ? "line-through text-gray-400" : "text-gray-800 font-medium"}">
              ${t.task}
            </p>
          </div>

          <div class="flex gap-2">
            <button 
              onclick="updateTodo(${t.id})"
              class="btn-success px-4 py-2 rounded-lg text-white font-semibold text-sm disabled:opacity-30 disabled:cursor-not-allowed"
              ${t.completed ? "disabled" : ""}
            >
              <i class="fa-solid fa-check"></i>
            </button>

            <button 
              onclick="deleteTodo(${t.id})"
              class="btn-danger px-4 py-2 rounded-lg text-white font-semibold text-sm"
            >
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>
        </div>
      `
      )
      .join("");
  }

  main.innerHTML =
    todoHTML +
    `
    <div class="flex gap-3 glass-effect p-5 rounded-xl shadow-lg mt-2">
      <input 
        id="todoInput" 
        placeholder="Add a new task..."
        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg transition-all"
      >
      <button 
        onclick="addTodo()"
        class="btn-primary text-white px-6 py-3 rounded-lg font-semibold"
      >
        <i class="fa-solid fa-plus mr-2"></i>Add
      </button>
    </div>
  `;

  updateCounts();
}


function changeTab(tab) {
  selectedTab = tab;
  navElements.forEach(b => b.classList.toggle("selected-tab", b.innerText.includes(tab)));
  renderTodos();
}

// ---------------- AUTH ----------------

function toggleIsRegister() {
  isRegistration = !isRegistration;
  
  document.querySelector("#auth h2").innerText = isRegistration ? "Create Account" : "Welcome Back";
  document.querySelector("#auth p").innerText = isRegistration ? "Sign up to get started" : "Sign in to manage your tasks";
  document.querySelector(".register-text").innerText =
    isRegistration ? "Already have an account?" : "Don't have an account?";
  registerBtn.innerText = isRegistration ? "Sign in" : "Sign up";
  authBtn.innerText = isRegistration ? "Sign Up" : "Sign In";
}

async function authenticate() {
  const emailVal = email.value;
  const passVal = password.value;

  if (!emailVal || !emailVal.includes("@") || passVal.length < 6) {
    errorBox.querySelector('span').innerText = "Please enter a valid email and password (min 6 characters)";
    show(errorBox, true);
    return;
  }

  show(errorBox, false);
  authBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i>Please wait...';
  authBtn.disabled = true;

  const route = isRegistration ? "auth/register" : "auth/login";
  const data = await api(route, "POST", { username: emailVal, password: passVal });

  if (!data.token) {
    errorBox.querySelector('span').innerText = "Authentication failed. Please try again.";
    show(errorBox, true);
    authBtn.innerHTML = isRegistration ? "Sign Up" : "Sign In";
    authBtn.disabled = false;
    return;
  }

  token = data.token;
  localStorage.setItem("token", token);
  showDashboard();
}

// ---------------- CRUD ----------------

async function fetchTodos() {
  todos = await api("todos");
  console.log(todos);
  renderTodos();
}

function updateTodo(id) {
  const task = todos.find(t => t.id === id)?.task;
  api(`todos/${id}`, "PUT", { task, completed: 1 }).then(fetchTodos);
}

function deleteTodo(id) {
  api(`todos/${id}`, "DELETE").then(fetchTodos);
}

function addTodo() {
  const input = document.getElementById("todoInput");
  if (!input.value.trim()) return;

  api("todos", "POST", { task: input.value }).then(() => {
    input.value = "";
    fetchTodos();
  });
}

// Add Enter key support
document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    if (document.activeElement === email || document.activeElement === password) {
      authenticate();
    } else if (document.activeElement?.id === 'todoInput') {
      addTodo();
    }
  }
});

// ---------------- INIT ----------------

if (token) showDashboard();

  </script>

</body>

</html>